# ios/Podfile
require_relative '../node_modules/react-native/scripts/react_native_pods'

platform :ios, '15.6'
prepare_react_native_project!

pre_install do |installer|
  # kakao-loginì€ static library ê°•ì œ (í•„ìš”ì‹œ ìœ ì§€)
  installer.pod_targets.each do |pod|
    if pod.name.start_with?('kakao-login')
      def pod.build_type; Pod::BuildType.static_library end
    end
  end

  # ğŸ”§ RN ë‚´ë¶€ podspecë“¤ì— ë°•íŒ fast_float 6.1.4 â†’ 8.0.0 ì¼ê´„ ì¹˜í™˜
  rn_dir = File.expand_path('../node_modules/react-native', __dir__)
  Dir.glob(File.join(rn_dir, '**/*.podspec')).each do |spec_path|
    next unless File.file?(spec_path)
    txt = File.read(spec_path)
    patched = txt.gsub(/(s\.dependency\s+["']fast_float["']\s*,\s*["'])6\.1\.4(["'])/i, '\18.0.0\2')
    File.write(spec_path, patched) if patched != txt
  end

  # fast_float podspec ìì²´ ë²„ì „ë„ 8.0.0ìœ¼ë¡œ ê³ ì •
  ff_path = File.join(rn_dir, 'third-party-podspecs/fast_float.podspec')
  if File.exist?(ff_path)
    txt = File.read(ff_path)
    patched = txt.gsub(/s\.version\s*=\s*['"].*?['"]/, "s.version = '8.0.0'")
    File.write(ff_path, patched) if patched != txt
  end
end

target 'CreditTalk' do
  config = use_native_modules!

  # FirebaseCoreInternal â†” GoogleUtilities ì •ì +Swift ê²½ê³  ë°©ì§€ (ìµœì†Œ ì„¤ì •)
  pod 'GoogleUtilities', :modular_headers => true

  # ì™¸ë¶€ SDK
  pod 'NidThirdPartyLogin'
  pod 'RNVectorIcons', :path => '../node_modules/react-native-vector-icons'

  use_react_native!(
    :path => config[:reactNativePath],
    :hermes_enabled => true,
    :new_arch_enabled => false
  )
end

post_install do |installer|
  react_native_post_install(installer)

  # ë¹„ëª¨ë“ˆ í¬í•¨ í—ˆìš©(ë¸Œë¦¬ì§• í—¤ë” ê²½ê³  ì–µì œ)
  installer.pods_project.targets.each do |t|
    t.build_configurations.each do |cfg|
      cfg.build_settings['CLANG_ALLOW_NON_MODULAR_INCLUDES_IN_FRAMEWORK_MODULES'] = 'YES'
    end
  end
end
